/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/(function(){var _=["require","exports","vs/tinia/authorizing-github","vs/workbench/workbench.web.api","vs/css!vs/tinia/authorizing-overlay","vs/tinia/util","vs/tinia/authorizing-overlay","vs/css!vs/code/browser/workbench/workbench","vs/code/browser/workbench/workbench","vs/base/common/uri","vs/base/common/event","vs/base/common/uuid","vs/base/common/cancellation","vs/base/common/buffer","vs/base/common/lifecycle","vs/base/parts/request/browser/request","vs/platform/windows/common/windows","vs/base/common/resources","vs/base/browser/browser","vs/nls!vs/code/browser/workbench/workbench","vs/base/common/network","vs/platform/product/common/product","vs/platform/log/common/log"],R=function(k){for(var a=[],f=0,u=k.length;f<u;f++)a[f]=_[k[f]];return a};define(_[4],R([7]),{}),define(_[5],R([0,1]),function(k,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.delegate=a.replaceBrowserUrl=a.getBrowserUrl=void 0;const f=()=>window.location.href;a.getBrowserUrl=f;const u=c=>{window.history.replaceState&&window.history.replaceState(null,"",c)};a.replaceBrowserUrl=u;const E=(c,p,w,U)=>c==null?void 0:c.addEventListener(w,function(r){const o=c.querySelectorAll(p);for(let s=0,l=o.length;s<l;s++)o[s]===r.target&&U.call(this,r)});a.delegate=E}),define(_[2],R([0,1,3]),function(k,a,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getGitHubAccessToken=void 0;const E="https://github.com/login/oauth/authorize?scope=repo,user:email&client_id=7d0a65abd28a0b19f30f",c="directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=800,height=520,top=150,left=150",p="https://auth.tinia.org",w=r=>new Promise(o=>setTimeout(o,r)),U=(r=!1)=>{const o=window.open(E,"_blank",c);return new Promise(s=>{let l=!1;!o&&r&&(l=!0,f.commands.executeCommand("tinia.vscode.get-github-access-token-with-overlay").then(g=>s(g)));const m=g=>{var T;g.origin!==p||o&&g.source!==o||((T=g.data)===null||T===void 0?void 0:T.type)!=="authorizing"||l&&!("access_token"in g.data.payload)||(l&&f.commands.executeCommand("tinia.vscode.hide-authorizing-overlay"),window.removeEventListener("message",m),s(g.data.payload))};window.addEventListener("message",m),w(300*1e3).then(()=>{window.removeEventListener("message",m),s({error:"authorizing_timeout",error_description:"Authorizing timeout"})})})};a.getGitHubAccessToken=U}),define(_[6],R([0,1,3,2,4]),function(k,a,f,u){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.hideAuthorizingOverlay=a.getGitHubAccessTokenWithOverlay=a.AuthorizingOverlay=void 0;const E=`
<div class="tinia-authorizing-dialog">
	<div class="close-button"></div>
	<div class="header-title">
		Authenticating to GitHub
	</div>
	<div class="features-description">
		<ul class="feature-list">
			<li class="feature-item">
				<a class="link" href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api#rate-limiting" target="_blank">Higher Rate Limit</a>
			</li>
			<li class="feature-item">
				<a class="link" href="https://docs.github.com/en/graphql/guides/forming-calls-with-graphql#authenticating-with-graphql" target="_blank">GitHub GraphQL API</a>
			</li>
			<li class="feature-item">
				<a class="link" href="https://docs.github.com/en/graphql/reference/objects#blame" target="_blank">Git Blame Feature</a>
			</li>
		</ul>
	</div>
	<div class="github-documentation">
		Read more about this on
		<a class="link"
			href="https://docs.github.com/en/github/authenticating-to-github"
			target="_blank">
			GitHub Documentation
		</a>
	</div>
	<div class="authorizing-methods">
		<button class="authorizing-button loading">
			<svg class="github-logo" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true">
				<path fill-rule="evenodd"
					d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
				</path>
			</svg>
			<span>Connect to GitHub</span>
		</button>
		<div class="split-line"></div>
		<form class="input-oauth-token-form">
			<input class="input-box" placeholder="\bInput OAuth Token" />
			<button type="submit" class="submit-button loading">Submit</button>
		</form>
		<div class="create-token-link">
			<a class="link" href="https://github.com/settings/tokens/new?scopes=repo&description=Tinia" target="_blank">
				Create New OAuth Token
			</a>
		</div>
	</div>
</div>
`;class c{constructor(){this._overlayVisible=!1,this._finishCallback=()=>{}}static getInstance(){return c._instance?c._instance:c._instance=new c}show(){if(this._overlayVisible!==!0)return this._overlayVisible=!0,document.body.classList.add("tinia-overlay-visible"),document.body.appendChild(this.getRootElement()),this.clearAllErrors(),new Promise(r=>this._finishCallback=r)}hide(){if(this._overlayVisible!==!1){this._overlayVisible=!1;const r=this.getDialogElement();r.classList.add("exiting"),setTimeout(()=>{r.classList.remove("exiting"),document.body.classList.remove("tinia-overlay-visible"),document.body.removeChild(this.getRootElement())},180)}}getRootElement(){return this._rootElement||(this._rootElement=this.createElements(),this.registerListeners()),this._rootElement}getDialogElement(){return this.getRootElement().querySelector(".tinia-authorizing-dialog")}createElements(){const r=document.createElement("div");return r.classList.add("tinia-authorizing-mask"),r.innerHTML=E,r}createErrorElement(r,o){const s=document.createElement("div");if(s.classList.add("error-message"),s.innerText=r,o){const l=document.createElement("a");l.setAttribute("href",o),l.setAttribute("target","_blank"),l.classList.add("link"),l.innerText="See more",s.appendChild(l)}return s}clearAllErrors(){var r;(r=this.getDialogElement().querySelectorAll(".error-message"))===null||r===void 0||r.forEach(o=>{var s;(s=o.parentElement)===null||s===void 0||s.removeChild(o)})}setAuthorizingButtonError(r,o){var s;this.clearAllErrors();const l=this.createErrorElement(r,o);(s=this.getDialogElement().querySelector(".authorizing-button"))===null||s===void 0||s.insertAdjacentElement("afterend",l)}async handleClickAuthorizingButton(){const r=await(0,u.getGitHubAccessToken)(!1);return"access_token"in r?(this._finishCallback(r),!0):("error"in r&&this.setAuthorizingButtonError(r.error_description,r.error_uri),!1)}setSubmitTokenError(r,o){var s;this.clearAllErrors();const l=this.createErrorElement(r,o);(s=this.getDialogElement().querySelector(".create-token-link"))===null||s===void 0||s.insertAdjacentElement("afterend",l)}async handleClickSubmitTokenButton(){var r;const o=(r=this.getDialogElement().querySelector(".input-oauth-token-form .input-box"))===null||r===void 0?void 0:r.value;if(!o)return this.setSubmitTokenError("Please input the token"),!1;const s=await f.commands.executeCommand("tinia.validate-token",o,!0);return s.valid?s.remaining<=0?(this.setSubmitTokenError("The token is valid, but it has exceeded the rate limit"),!1):(this._finishCallback({access_token:o}),!0):(this.setSubmitTokenError("The token is invalid"),!1)}registerListeners(){var r;const o=this.getDialogElement();(r=o.querySelector(".close-button"))===null||r===void 0||r.addEventListener("click",()=>{this._finishCallback({error:"user_canceled",error_description:"Authorizing canceled"}),this.hide()});const s=o.querySelector(".authorizing-button");s==null||s.addEventListener("click",async()=>{this.clearAllErrors(),s.setAttribute("disabled","disabled"),await this.handleClickAuthorizingButton()&&this.hide(),s.removeAttribute("disabled")});const l=o.querySelector(".input-oauth-token-form .submit-button");l==null||l.addEventListener("click",async m=>{m.preventDefault(),this.clearAllErrors(),l.setAttribute("disabled","disabled"),await this.handleClickSubmitTokenButton()&&this.hide(),l.removeAttribute("disabled")})}}a.AuthorizingOverlay=c;const p=()=>c.getInstance().show();a.getGitHubAccessTokenWithOverlay=p;const w=()=>c.getInstance().hide();a.hideAuthorizingOverlay=w}),define(_[8],R([0,1,3,9,10,11,12,13,14,15,16,17,18,19,20,21,22,5,2,6]),function(k,a,f,u,E,c,p,w,U,r,o,s,l,m,g,T,N,Y,z,H){"use strict";Object.defineProperty(a,"__esModule",{value:!0});const $=()=>[{id:"tinia.vscode.get-browser-url",handler:Y.getBrowserUrl},{id:"tinia.vscode.replace-browser-url",handler:Y.replaceBrowserUrl},{id:"tinia.vscode.get-github-access-token",handler:z.getGitHubAccessToken},{id:"tinia.vscode.get-github-access-token-with-overlay",handler:H.getGitHubAccessTokenWithOverlay},{id:"tinia.vscode.hide-authorizing-overlay",handler:H.hideAuthorizingOverlay}];function q(S,t){let e;if(t){let i=0;t.forEach((n,v)=>{e||(e=""),e+=`${i++==0?"":"&"}${v}=${encodeURIComponent(n)}`})}return u.URI.parse(window.location.href).with({path:S,query:e})}class O{constructor(){let t;const e=document.getElementById("vscode-workbench-auth-session"),i=e?e.getAttribute("data-settings"):void 0;if(i)try{t=JSON.parse(i)}catch(n){}t&&(this.setPassword(`${T.default.urlProtocol}.login`,"account",JSON.stringify(t)),this.authService=`${T.default.urlProtocol}-${t.providerId}.login`,this.setPassword(this.authService,"account",JSON.stringify(t.scopes.map(n=>({id:t.id,scopes:n,accessToken:t.accessToken})))))}get credentials(){if(!this._credentials){try{const t=window.localStorage.getItem(O.CREDENTIALS_OPENED_KEY);t&&(this._credentials=JSON.parse(t))}catch(t){}Array.isArray(this._credentials)||(this._credentials=[])}return this._credentials}save(){window.localStorage.setItem(O.CREDENTIALS_OPENED_KEY,JSON.stringify(this.credentials))}async getPassword(t,e){return this.doGetPassword(t,e)}async doGetPassword(t,e){for(const i of this.credentials)if(i.service===t&&(typeof e!="string"||e===i.account))return i.password;return null}async setPassword(t,e,i){this.doDeletePassword(t,e),this.credentials.push({service:t,account:e,password:i}),this.save();try{if(i&&t===this.authService){const n=JSON.parse(i);Array.isArray(n)&&n.length===0&&await this.logout(t)}}catch(n){console.log(n)}}async deletePassword(t,e){const i=await this.doDeletePassword(t,e);if(i&&t===this.authService)try{await this.logout(t)}catch(n){console.log(n)}return i}async doDeletePassword(t,e){let i=!1;return this._credentials=this.credentials.filter(n=>n.service===t&&n.account===e?(i=!0,!1):!0),i&&this.save(),i}async findPassword(t){return this.doGetPassword(t)}async findCredentials(t){return this.credentials.filter(e=>e.service===t).map(({account:e,password:i})=>({account:e,password:i}))}async logout(t){const e=new Map;e.set("logout",String(!0)),e.set("service",t),await(0,r.request)({url:q("/auth/logout",e).toString(!0)},p.CancellationToken.None)}}O.CREDENTIALS_OPENED_KEY="credentials.provider";class d extends U.Disposable{constructor(){super(...arguments);this._onCallback=this._register(new E.Emitter),this.onCallback=this._onCallback.event}create(t){const e=new Map,i=(0,c.generateUuid)();e.set(d.QUERY_KEYS.REQUEST_ID,i);const{scheme:n,authority:v,path:b,query:D,fragment:I}=t||{scheme:void 0,authority:void 0,path:void 0,query:void 0,fragment:void 0};return n&&e.set(d.QUERY_KEYS.SCHEME,n),v&&e.set(d.QUERY_KEYS.AUTHORITY,v),b&&e.set(d.QUERY_KEYS.PATH,b),D&&e.set(d.QUERY_KEYS.QUERY,D),I&&e.set(d.QUERY_KEYS.FRAGMENT,I),this.periodicFetchCallback(i,Date.now()),q("/callback",e)}async periodicFetchCallback(t,e){const i=new Map;i.set(d.QUERY_KEYS.REQUEST_ID,t);const n=await(0,r.request)({url:q("/fetch-callback",i).toString(!0)},p.CancellationToken.None),v=await(0,w.streamToBuffer)(n.stream);if(v.byteLength>0){try{this._onCallback.fire(u.URI.revive(JSON.parse(v.toString())))}catch(b){console.error(b)}return}Date.now()-e<d.FETCH_TIMEOUT&&setTimeout(()=>this.periodicFetchCallback(t,e),d.FETCH_INTERVAL)}}d.FETCH_INTERVAL=500,d.FETCH_TIMEOUT=5*60*1e3,d.QUERY_KEYS={REQUEST_ID:"vscode-requestId",SCHEME:"vscode-scheme",AUTHORITY:"vscode-authority",PATH:"vscode-path",QUERY:"vscode-query",FRAGMENT:"vscode-fragment"};class h{constructor(t,e){this.workspace=t,this.payload=e,this.trusted=!0}async open(t,e){if((e==null?void 0:e.reuse)&&!e.payload&&this.isSame(this.workspace,t))return!0;const i=this.createTargetUrl(t,e);if(i){if(e==null?void 0:e.reuse)return window.location.href=i,!0;{let n;return l.isStandalone?n=window.open(i,"_blank","toolbar=no"):n=window.open(i),!!n}}return!1}createTargetUrl(t,e){let i;return t?(0,o.isFolderToOpen)(t)?i=`${document.location.origin}${document.location.pathname}?${h.QUERY_PARAM_FOLDER}=${encodeURIComponent(t.folderUri.toString())}`:(0,o.isWorkspaceToOpen)(t)&&(i=`${document.location.origin}${document.location.pathname}?${h.QUERY_PARAM_WORKSPACE}=${encodeURIComponent(t.workspaceUri.toString())}`):i=`${document.location.origin}${document.location.pathname}?${h.QUERY_PARAM_EMPTY_WINDOW}=true`,(e==null?void 0:e.payload)&&(i+=`&${h.QUERY_PARAM_PAYLOAD}=${encodeURIComponent(JSON.stringify(e.payload))}`),i}isSame(t,e){return!t||!e?t===e:(0,o.isFolderToOpen)(t)&&(0,o.isFolderToOpen)(e)?(0,s.isEqual)(t.folderUri,e.folderUri):(0,o.isWorkspaceToOpen)(t)&&(0,o.isWorkspaceToOpen)(e)?(0,s.isEqual)(t.workspaceUri,e.workspaceUri):!1}hasRemote(){if(this.workspace){if((0,o.isFolderToOpen)(this.workspace))return this.workspace.folderUri.scheme===g.Schemas.vscodeRemote;if((0,o.isWorkspaceToOpen)(this.workspace))return this.workspace.workspaceUri.scheme===g.Schemas.vscodeRemote}return!0}}h.QUERY_PARAM_EMPTY_WINDOW="ew",h.QUERY_PARAM_FOLDER="folder",h.QUERY_PARAM_WORKSPACE="workspace",h.QUERY_PARAM_PAYLOAD="payload";class Q{constructor(t){this.onDidChange=E.Event.None;let e,i;if(t){let n;(0,o.isFolderToOpen)(t)?n=t.folderUri:(0,o.isWorkspaceToOpen)(t)&&(n=t.workspaceUri),(n==null?void 0:n.scheme)==="tinia"&&([e="tinialabs",i="studio"]=u.URI.parse((0,Y.getBrowserUrl)()).path.split("/").filter(Boolean))}i&&e?(this.label=(0,m.localize)(0,null,e,i),this.tooltip=(0,m.localize)(1,null,e,i)):(this.label=(0,m.localize)(2,null),this.tooltip=(0,m.localize)(3,null))}}(function(){const S=document.getElementById("vscode-workbench-web-configuration"),t=S?S.getAttribute("data-settings"):void 0;if(!S||!t)throw new Error("Missing web configuration element");const e=JSON.parse(t);let i=!1,n,v=Object.create(null),b;new URL(document.location.href).searchParams.forEach((y,A)=>{switch(A){case h.QUERY_PARAM_FOLDER:n={folderUri:u.URI.parse(y)},i=!0;break;case h.QUERY_PARAM_WORKSPACE:n={workspaceUri:u.URI.parse(y)},i=!0;break;case h.QUERY_PARAM_EMPTY_WINDOW:n=void 0,i=!0;break;case h.QUERY_PARAM_PAYLOAD:try{v=JSON.parse(y)}catch(P){console.error(P)}break;case"logLevel":b=y;break}}),i||(e.folderUri?n={folderUri:u.URI.revive(e.folderUri)}:e.workspaceUri?n={workspaceUri:u.URI.revive(e.workspaceUri)}:n=void 0);const I=new h(n,v),G={href:"https://tinia.org",icon:"code",title:(0,m.localize)(4,null)};let M;I.hasRemote()||(M=new Q(n));const B=y=>{let A=`quality=${y}`;new URL(document.location.href).searchParams.forEach((L,C)=>{C!=="quality"&&(A+=`&${C}=${L}`)}),window.location.href=`${window.location.origin}?${A}`},F=e.settingsSyncOptions?{enabled:e.settingsSyncOptions.enabled,enablementHandler:y=>{let A=`settingsSync=${y?"true":"false"}`;new URL(document.location.href).searchParams.forEach((L,C)=>{C!=="settingsSync"&&(A+=`&${C}=${L}`)}),window.location.href=`${window.location.origin}?${A}`}}:void 0;(0,f.create)(document.body,Object.assign(Object.assign({},e),{developmentOptions:Object.assign({logLevel:b?(0,N.parseLogLevel)(b):void 0},e.developmentOptions),commands:$(),settingsSyncOptions:F,homeIndicator:G,windowIndicator:M,productQualityChangeHandler:B,workspaceProvider:I,urlCallbackProvider:new d,credentialsProvider:new O}))})()})}).call(this);

//# sourceMappingURL=workbench.js.map
